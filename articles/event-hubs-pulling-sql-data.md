<properties
   pageTitle="将 SQL 数据提取到 Azure 事件中心 | Azure"
   description="从 SQL 示例进行事件中心导入的概述"
   services="event-hubs"
   documentationCenter="na"
   authors="spyrossak"
   manager="timlt"
   editor=""/>

<tags 
   ms.service="event-hubs"
   ms.date="02/26/2016"
   wacn.date="04/05/2016" />

# 将数据从 SQL 提取到 Azure 事件中心

一个针对处理实时数据的典型应用程序体系结构必须先将该数据推送到 Azure 事件中心。它可能是 IoT 方案（例如监视高速公路不同区段的车流量）、游戏方案（监视大量狂热竞赛者的动作）或企业方案（例如监视建筑物的占用情况）。在这些情况下，数据生成者通常是外部对象，生成需要收集、分析、存储及处理的时间序列数据，并且可能已经入大量心力构建这些流程的基础结构。如果想要从类似数据库，而非从流数据来源带入数据，并配合其他流数据一起使用，该如何进行？ 请考虑想要使用 Azure 流分析、远程数据资源管理器 (RDX) 或其他工具，来分析及处理来自 Microsoft Dynamics AX 或者自定义设施管理系统的缓慢更改数据的情况？ 为了解决此问题，我们已编写开放源代码的小型云示例，可以让进行修改并部署，以从 SQL 数据表提取数据，并将数据推送到 Azure 事件中心，以作为下游分析应用中的输入使用。请务必了解这是个罕见的方案，也和平常使用事件中心的方式相反。但是，如果发现自己处于必须执行此类操作的情况之下，可以在 Azure 示例库中找到该代码，位置在[此处](https://github.com/Azure-Samples/event-hubs-dotnet-import-from-sql)。

请注意，本示例中的代码只是个示例。此示例**并不**旨在作为生产应用程序，并且未尝试使它适合于在这类环境中使用 - 它完全是个 DIY，仅仅是以开发人员为中心的示例。在确定端到端体系结构之前，需要审查各种安全、性能、功能和成本因素。

## 应用程序结构

该应用程序是以 C# 编写的，示例中的 readme.md 包含修改、生成和发布应用程序所需的全部信息。以下部分提供了有关该应用程序的功能的全面概述。

我们首先假设你有权访问一个 SQL Azure 表。你还需要设置 Azure 事件中心，并了解访问它所需的连接字符串。

当 SqlToEventHub 解决方案启动时，如 readme.md 文件中所述，它会读取配置文件 (App.config) 来获取一些信息：这些内容很容易理解，如表的名称等等，因此不需要在此重新叙述它们的解释。

应用程序在读取配置文件之后便进入循环、读取 SQL 表、将记录推送到事件中心，然后等待用户定义的休眠间隔结束，并将上述步骤全部再做一遍。有几件事值得一提：

1. 应用程序是以 SQL 表正由某些外部进程进行更新，并且想要将所有更新（且仅限更新）发送到事件中心此假设置为基础。
2. SQL 表必须有一个拥有唯一且不断增加之数字的字段，例如一个记录号码。这可以单纯是个称为“Id”的字段，或者任何其他随着数据库添加记录而增加的项目，例如“Creation\_time”或“Sequence\_number”。应用程序在每次反复计算时记录并存储该字段的值。应用程序于后续每次通过循环时，基本上便是查询表，并针对所有该字段的值超过应用上一次通过循环时所记录的值的情况做出记录。我们将此最后的值称为“偏移”。
3. 应用程序在启动时创建“TableOffsets”表，以存储偏移。表是通过在配置文件中定义的“CreateOffsetTableQuery”查询所创建。 
4. 有多个配合偏移表使用的查询，在配置文件中被定义为“OffsetQuery”、“UpdateOffsetQuery”及“InsertOffsetQuery”。你不应更改这些值。
5. 最后，在配置文件中定义的“DataQuery”查询，便是运行以从 SQL 表提取记录的查询。目前基于优化的目的，该查询在每次通过循环时，被限制只能提取前 1,000 条记录 - 例如，如果在上一次查询之后有 25,000 条记录被添加到数据库，则可能需要花费一段时间才能运行查询。通过将每次的查询限制在 1,000 条记录，查询变得更加快速。选择前 1,000 条记录，便能简单地将后续的 1,000 条记录批次推送到事件中心。    

## 后续步骤

若要部署解决方案，请克隆或下载 SqlToEventHub 应用程序，编辑 App.config 文件，生成它，最后发布它。发布应用程序后，可以在云服务下面的 Azure 经典门户中查看它的运行状况，并监视传入事件中心的事件。请注意，频率将取决于两个因素：SQL 表的更新频率，以及在应用程序配置文件中指定的休眠间隔。
<!---HONumber=Mooncake_0328_2016-->