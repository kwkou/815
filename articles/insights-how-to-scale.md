<properties title="How to scale a website" pageTitle="How to scale a website" description="Learn how to scale your hosting plan in Azure." authors="stepsic"  />

# 如何缩放网站

在 Azure 门户预览版中，你可以手动设置 Web 托管计划的实例计数，或者设置参数以自动缩放 Web 托管计划。在为 Web 托管计划配置缩放之前，应该考虑到缩放会受实例大小的影响。实例大小越大，其核心和内存就越多，因此在实例数目相同的前提下，它们的性能也就越好。

缩放会影响到整个 Web 托管计划。在创建网站时，你可以选择创建新的 Web 托管计划或编辑现有的 Web 托管计划。设置一个 Web 托管计划后，所有站点将共享相同的实例，因此它们会统一缩放。

## 缩放 Web 托管计划

1.  在 [Azure 门户预览版][Azure 门户预览版]中，依次单击“浏览”和“网站”，然后单击网站的名称以打开分页。

2.  “网站”分页的“操作”小视窗上的“缩放”部件将会告诉你 Web 托管计划的状态：当你手动缩放时，会显示“关闭”；当你按一个或多个性能度量值缩放时，会显示“性能”；当你启用了多个自动缩放配置文件时，会显示“计划”。

    ![“缩放”部件][“缩放”部件]

3.  单击该部件会转到“缩放”分页。在缩放分页的顶部，可以看到 Web 托管计划的自动缩放操作历史记录。

    ![“缩放”分页][“缩放”分页]

4.  可以使用“实例”滑块手动调整运行你的 Web 托管计划的虚拟机数。

5.  如果你希望根据负载自动调整实例数，请在“自动缩放模式”下选择“性能”。此时，你无法在 Azure 门户预览版中选择“计划”。

    ![显示了 CPU 百分比的“缩放”分页][显示了 CPU 百分比的“缩放”分页]

6.  选择“性能”后，将会发生两项变化：

    -   “实例范围”现在允许你选择最大和最小实例计数。不管负载如何，自动缩放时都会保持在此计数范围内。
    -   可以在“目标度量值”部分中定义性能度量值

7.  “CPU 百分比”部分允许你设置 Web 托管计划中所有实例消耗的平均 CPU 目标值。当平均 CPU 超出你定义的最大值时，将会扩展服务。

启用自动缩放后，“网站”分页的部件中会显示“性能”，并且图表中会显示你的缩放历史记录：

![显示了 CPU 百分比的“缩放”分页][1]

请注意，在 Azure 门户预览版中，你无法更改共享的 Web 托管计划的实例数。

## 高级缩放

Azure 门户预览版的一项新功能是，你可以基于除“CPU 百分比”以外的其他度量值进行缩放，甚至还可以使用复杂的扩展和缩减规则集。

### 基于其他性能度量值进行缩放

除了 CPU 以外，你还可以基于下列各项进行缩放：

-   平均内存 - 如果实例上使用的平均内存百分比高于或低于指定的阈值，则会添加或删除实例。
-   HTTP 队列深度或磁盘队列深度 - 如果 HTTP 请求队列或磁盘队列中的消息数高于或低于指定的阈值，则会添加或删除实例。

可以使用两种不同的方式来根据另一个度量值进行缩放。如果只想要按一个度量值进行缩放，请选择“CPU 百分比”滑块旁边的 \> 标记。随后将会打开“度量值详细信息”分页：

![缩放度量值的入口点][缩放度量值的入口点]

若要一次性按多个度量值进行缩放，可以在命令栏中单击“添加度量值”：

![添加度量值][添加度量值]

“度量值详细信息”分页包含设置最佳缩放配置文件所要使用的所有控件。在顶部选择要用作缩放依据的新度量值。

### 使用多个步骤进行缩放

以下度量值图表包括两个部分：“扩展规则”和“缩减规则”。如果符合**任何**一条扩展规则，你的服务将会扩展。相反，如果符合**所有**缩减规则，你的服务将会缩减。

对于选择的每个规则：

-   条件 - 大于或小于
-   阈值 - 在触发操作之前此度量值必须超过的数字
-   基于过去的时间 - 计算此度量值的平均值时所依据的分钟数
-   扩展或缩减比率 - 缩放操作的规模
-   等待时间 - 前一缩放操作之后，此规则应等待多长时间才能再次缩放

   ![多个缩放规则][多个缩放规则]

启用多个缩放规则后，当性能发生变化时，你可以更主动地扩展（或缩放）。例如，你可以定义两个缩放规则：

1.  如果 CPU 百分比超出 60%，则按 1 个实例扩展

2.  如果 CPU 百分比超出 85%，则按 3 个实例扩展

启用这条附加规则后，如果在执行缩放操作之前负载超出 85%，你将会看到两个附加实例而不是一个。

  [Azure 门户预览版]: https://portal.azure.com/
  [“缩放”部件]: ./media/insights-how-to-scale/Insights_ScalePartOff.png
  [“缩放”分页]: ./media/insights-how-to-scale/Insights_ScaleBladeDayZero.png
  [显示了 CPU 百分比的“缩放”分页]: ./media/insights-how-to-scale/Insights_ScaleBladeCPU.png
  [1]: ./media/insights-how-to-scale/Insights_ScalePartBladeOn.png
  [缩放度量值的入口点]: ./media/insights-how-to-scale/Insights_ScaleMetricChevron.png
  [添加度量值]: ./media/insights-how-to-scale/Insights_AddMetric.png
  [多个缩放规则]: ./media/insights-how-to-scale/Insights_MultipleScaleRules.png
