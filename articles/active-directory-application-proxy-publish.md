<properties
	pageTitle="使用 Azure AD 应用程序代理发布应用"
	description="介绍如何使用 Azure AD 应用程序代理发布本地应用程序。"
	services="active-directory"
	documentationCenter=""
	authors="rkarlin"
	manager="terrylan"
	editor=""/>

<tags
	ms.service="active-directory"
	ms.date="06/02/2015"
	wacn.date="08/29/2015"/>


# 使用 Azure AD 应用程序代理发布应用程序

> [AZURE.NOTE]应用程序代理是一项仅当升级到高级版或基本版的 Azure Active Directory 才可用的功能。有关详细信息，请参阅 [Azure Active Directory 版本](https://msdn.microsoft.com/zh-cn/library/azure/dn532272.aspx)。

启用 Azure AD 应用程序代理后，可以发布应用程序，使专用网络外部的用户可以访问这些应用程序。

本部分将指导你完成发布在本地网络（你需要为其启用从网络外部进行安全远程访问）上运行的应用程序所需的步骤。

> [AZURE.NOTE]若要验证连接器是否运行正常，发布的第一个应用程序应为可从专用网络内进行访问的任何网站，以确保用户可以从 Internet 访问它，再发布实际的应用程序。

## 使用向导发布应用

1. 打开所选择的浏览器并转到 Azure 管理门户。
2. 在 Azure 管理门户的左窗格中，单击“Active Directory”选项卡。
3. 单击在其中启用了应用程序代理并要对其发布应用程序（例如，Wingtip Toys）的目录。
4. 单击“应用程序”选项卡，然后单击屏幕底部的“添加”按钮![添加应用程序](http://i.imgur.com/wEeZ7IR.png)
5. 在“想要执行何种操作?”对话框中，单击“发布将从网络外进行访问的应用程序”。![将可从网络外部访问新应用程序](http://i.imgur.com/Wj3vkyD.png)

6. 按照在屏幕上的说明，提供有关应用程序的以下信息：![应用程序属性](http://i.imgur.com/MkPNc93.png)

**设置** | **详细信息**
---|---
外部 URL | 这是用于从专用网络外部访问应用程序的云服务 URL。基于你提供的名称，会自动生成具有 msappproxy.net 后缀的 URL。
预身份验证方法 | <p>设置想要应用程序使用的预身份验证方法类型：</p><p> a.Windows Azure Active Directory (Windows Azure AD) – 对 Windows Azure Active Directory (Windows Azure AD) 设置预身份验证方法。当用户尝试访问应用程序时，应用程序代理将重定向用户使用 Azure AD 进行登录，Azure AD 将对用户进行身份验证，确保用户具有对目录和应用程序的必要权限。</p><p> b.传递 – 不执行预身份验证。</p>
外部 URL 协议 | <p>默认情况下，使用 HTTPS 协议发布应用程序。</p> <p>若要为内部应用程序启用 HTTP，必须将“预身份验证”设置为“传递”，然后就可以将外部 URL 协议从 HTTPS 更改为 HTTP。</p> <p>请注意，使用 HTTP 发布应用程序可能会对应用程序和用户产生安全问题。</p> <p>可以插入自定义域，而不是使用默认域 msappproxy.net。有关详细信息，请参阅以下内容。</p>
内部 URL | 这是应用程序代理连接器用于内部访问应用程序的内部 URL。这应该是用于从专用网络内部访问应用程序的已发布应用程序的 URL。这是一个有效的 URL，不包含路径、空格或符号。

若要完成该向导，请单击屏幕底部的复选标记。现在，便在 Azure AD 中定义了应用程序。



## 将用户和组分配到应用程序

1. 对于已进行预身份验证的应用，必须分配将具有对该应用的访问权限的用户和组。<p>对于传递的应用，所有用户均可以访问。但是，为了使用户查看应用程序列表中的应用，必须将应用分配给该用户。
2. 完成“添加应用”向导后，将显示“应用代理快速启动”页。若要分配用户，请单击“分配用户”。![应用程序代理快速启动屏幕](http://i.imgur.com/OmuWElV.png)
3. 选择要分配给此应用的各个用户或组，然后单击“分配”。 

> [AZURE.NOTE]对于集成 Windows 身份验证应用，可以仅从本地 Active Directory 中分配同步的用户和组。不能将使用以 Microsoft 帐户和来宾身份登录的用户分配给使用 Azure Active Directory 应用程序代理发布的应用。请确保分配的用户登录时所使用的凭据与你正发布的应用属于同一个域。

## 高级配置

1. 可以修改已发布的应用或从“配置”页面配置高级选项，例如对本地应用程序的 SSO。![高级配置](http://i.imgur.com/FhbRvoq.png)

2. 选择应用，然后单击“配置”。提供了以下选项：

**设置** | **详细信息**
---|---
名称 | 提供应用程序的描述性名称
外部 URL | 这是用于从专用网络外部访问应用程序的云服务 URL。根据你所提供的名称，将自动生成带有后缀 **msappproxy.net** 的 URL。
预身份验证方法 | 设置想要应用程序使用的预身份验证方法类型：<p>Active directory – 对 Active Directory 设置预身份验证方法。当用户尝试访问应用程序时，应用程序代理将重定向用户使用应用程序代理进行登录，应用程序代理将对用户进行身份验证，确保用户具有对目录和应用程序的必要权限。</p><p> 传递 – 不执行预身份验证。</p>
外部 URL | 默认情况下，使用 HTTPS 协议发布应用程序。若要为内部应用程序启用 HTTP，必须将“预身份验证”设置为“传递”，然后就可以将外部 URL 协议从 HTTPS 更改为 HTTP。请注意，使用 HTTP 发布应用程序可能会对应用程序和用户带来安全问题。可以设置自定义域，而不是使用提供的默认域 (msappproxy.net)。有关详细信息，请参阅“使用自定义域”。
内部 URL | 这是应用程序代理连接器用于内部访问应用程序的内部 URL。这应该是用于从专用网络内部访问应用程序的已发布应用程序的 URL。这是一个有效的 URL，不包含路径、空格或符号。
转换标头中的 URL | 对于需要 HTTP 主机标头不进行转换的应用程序（比如某些 SharePoint 配置），将此设置为“否”。这将禁用请求和响应标头的标头转换。
内部身份验证方法 | 如果使用应用程序代理进行预身份验证，可以设置内部身份验证方法，使用户能够从单一登录 (SSO) 到此应用程序中受益。<p>如果应用程序使用 IWA，则选择“集成 Windows 身份验证 (IWA)”，然后可以配置 Kerberos 约束委派 (KCD)，以对此应用程序启用 SSO。<p>如果应用程序不使用 IWA，则选择“无”。<p>使用 IWA 的应用程序必须使用 KCD 进行配置，否则应用程序代理将不能发布这些应用程序。<p>有关详细信息，请参阅“借助应用代理，使用 KCD 的本地 IWA 应用的 SSO”
内部应用程序 SPN | 这是内部应用程序的服务主体名称 (SPN)，正如本地应用程序代理中配置的一样。SPN 由应用程序代理连接器用于提取使用 Kerberos 约束委派 (KCD) 的应用程序的 Kerberos 令牌。<p>有关详细信息，请参阅“借助应用代理，使用 KCD 的本地 IWA 应用的 SSO”

使用 Azure Active Directory 应用程序代理发布应用程序后，它们将显示在 Azure AD 中的应用程序列表中，并且可以从 Azure AD 对它们进行管理。如果在发布应用程序后禁用了应用程序代理服务，则不会删除应用程序，但将不再能够从专用网络外部对其进行访问。若要查看应用程序并确保可对其进行访问，请双击该应用程序的名称。如果禁用了应用程序代理服务并且应用程序不可用，则将在屏幕顶部显示一条警告消息。若要删除应用程序，请在列表中选择一个应用程序，然后单击“删除”。

## 其他资源

* [关于 Kerberos 约束委派](http://technet.microsoft.com/zh-cn/library/cc995228.aspx)

<!---HONumber=67-->