<properties 
    pageTitle="服务总线定价和计费|Azure"
    description="服务总线定价结构概述。"
    services="service-bus"
    documentationCenter="na"
    authors="sethmanheim"
    manager="timlt"
    editor="" />
<tags 
   ms.service="service-bus"
    ms.date="03/16/2016"
   wacn.date="04/05/2016" />

# 服务总线定价和计费

服务总线推出基本、标准和[高级](/documentation/articles/service-bus-premium-messaging/)三种层级。你可以为你创建的每个服务总线服务命名空间选择一个服务层，所选的服务层可应用于在该命名空间中创建的所有队列、主题/订阅、中继和事件中心。

>[AZURE.NOTE] 有关当前服务总线定价的详细信息，请参阅 [Azure 服务总线定价页](/pricing/details/service-bus/)和[服务总线定价常见问题](/documentation/articles/service-bus-pricing-faq/)。

服务总线使用以下两种测定仪用于队列和主题/订阅：

1. **消息传送操作**：指对队列或主题/订阅服务终结点进行的 API 调用。此测定仪将替换发送或接收作为队列和主题/订阅的计费用量的主要单元的消息。

2. **中转连接**：指针对队列、主题/订阅或事件中心在给定的 1 小时采样期间打开的持久连接的峰数。此测定仪仅适用于标准层。你可以在标准层中打开其他连接（以前，每个队列/主题/订阅的连接数限制为 100 个），但只需支付极少的连接费用。

**标准**层引入了分级定价用于队列和主题/订阅执行的操作，在达到最高使用率级别时可享受 80%的基于卷的折扣。

**高级**层在 CPU 和内存层提供了资源隔离，以便每个客户工作负荷以隔离方式运行。此资源容器称为消息传送单元。每个高级命名空间至少会分配一个消息传送单元。你可以为每个服务总线高级命名空间购买 1、2 或 4 个消息传送单元。单一工作负荷或实体可以跨多个消息传送单元，尽管计费以 24 小时或每天的费率收取，但仍然可以随意更改消息传送单元数。从而为基于服务总线的解决方案提供可预测和稳定的性能。此性能不仅更易于预测和实现，而且速度更快。Azure 服务总线高级消息传送以在 Azure 事件中心引入的存储引擎为基础。使用高级消息传送，峰值性能比标准层快得多。

请注意，每个 Azure 订阅每月仅需支付一次标准基础费用。这意味着在你创建了一个标准或高级层级的服务总线命名空间后，你将能够在同一 Azure 订阅下创建任意数目的标准或高级层级命名空间，而不会产生附加的基础费用。

在 2014 年 11 月 1 日之前创建的所有现有服务总线命名空间会自动放入标准层。这可确保你继续有权访问服务总线当前可用的所有功能。随后，可以根据需要使用 [Azure 管理门户][]降级到基本层。

下表总结了基本和标准/高级层之间的功能差异。

|功能|基本|标准/高级|
|---|---|---|
|事件中心|是|是|
|队列|是|是|
|计划的消息|是|是|
|主题/订阅|否|是|
|中继|否|是|
|事务|否|是|
|重复数据删除|否|是|
|会话|否|是|
|大型消息|否|是|
|ForwardTo|否|是|
|SendVia|否|是|
|附送中转连接|每个服务总线命名空间 100|每个 Azure 订阅 1,000。|
|中转连接（允许超额）|否|是（可计费）|

## 消息传送操作

作为新的定价模型的一部分，针对队列和主题/订阅的计费已发生了变化。这些实体从按消息计费转换为按操作计费。“操作”是指针对队列或主题/订阅服务终结点所做的任何 API 调用。这包括管理、发送/接收和会话状态操作。

|操作类型|说明|
|---|---|
|管理|针对队列或主题/订阅的创建、读取、更新、删除 (CRUD) 操作。|
|消息传递|借助队列或主题/订阅发送和接收消息。|
|会话状态|获取队列或主题/订阅的会话状态或设置该状态。|

从2016年4月1日起，消息传送操作的价格会下调 25.5%，以下是下调后的新价格：

|基本|成本|
|---|---|
|操作|每百万个操作 0.31 元|

|标准|成本|
|---|---|
|基本费用|63.29 元/月|
|前 1250 万个操作/月|附送|
|8800 万 - 1 亿个操作/月|每百万个操作 5.21 元|
|1 亿 - 25 亿个操作/月|每百万个操作 3.20 元|
|超过 25 亿个操作/月|每百万个操作 1.27 元|

>[AZURE.NOTE]高级层当前为预览版，以下价格中包含 50% 的预览版折扣。


## 中转连接

*中转连接*允许客户的使用模式涉及针对队列、主题/订阅或事件中心的大量“永久连接”发送方/接收方。永久连接的发送方/接收方是使用具有非零接收超时（例如，HTTP 长轮询）的 AMQP 或 HTTP 连接的那些。具有立即超时的 HTTP 发送方和接收方不会生成中转连接。

以前，队列和主题/订阅限制为每个 URL 100 个并发连接。当前的计费方案中删除了针对队列和主题/订阅的每个 URL 限制，并根据服务总线命名空间和 Azure 订阅级别的中转连接实现配额和计量。

基本层包括并严格限制为每个服务总线命名空间 100 个中转连接。连接数目大于此数字将被拒绝用于基本层中。标准层中删除了每个命名空间限制，并跨 Azure 订阅的聚合中转连接使用情况计数。在标准层中，每个 Azure 订阅的前 1000 个中转连接将不收取额外费用（超出基本的费用）。在 Azure 订阅中使用标准层服务总线总计超过 1000 个中转连接将按分级计划收费，如下表所示。

|中转连接（标准层级）|成本|
|---|---|
|前 1000 个/月|包含在基本费用内|
|1,000-100,000 个/月|每连接 0.18 元/月|
|100,000-500,000 个/月|每连接 0.15 元/月|
|超过 500,000 个/月|每连接 0.10 元/月|

>[AZURE.NOTE]标准消息传送层（通过基本费用）包括 1,000 个中转连接，可在关联的 Azure 订阅内跨所有队列、主题/订阅和事件中心共享这些中转连接。

>[AZURE.NOTE]根据并发连接的峰值数量计费，按照每月 744 小时，每小时按比例分配费用。

|高级层级
|---|
|在“高级”层级中，中转连接不计费。|

有关中转连接的详细信息，请参阅本主题中后面的[常见问题](#FAQ)部分。

## 中继

中继仅适用于标准层命名空间。另外，中继的定价和连接配额保持不变。这意味着中继将继续根据消息数（而不是操作数）和中继小时数计费。

|中继定价|成本|
|---|---|
|中继小时数|每 100 中继小时数收取 0.52 元|
|消息|每 10,000 条消息收取 0.05 元|

## 常见问题

### 如何计算中继小时数？

请参阅[此主题](/documentation/articles/service-bus-pricing-faq/#How-is-the-Relay-Hours-meter-calculated?)。

### 什么是中转连接，它的计费方式是怎样的？

中转连接定义为下列其中一项：

1. 从客户端到服务总线主题/订阅、队列或事件中心的 AMQP 连接。

2. 从接收超时值大于零的服务总线主题或队列接收消息的 HTTP 调用。

超出附送数量（标准层为 1,000）的峰值并发中转连接数的服务总线收费。峰值将每小时计量一次，按照每月 744 小时按比例分配费用，并在每月计费周期内累加。在计费周期结束时，将会针对按比例分配的小时峰值的总和应用附送数量（每月 1,000 个中转连接）。

例如：

3. 通过一个 AMQP 连接来与 10,000 台设备建立连接，并从服务总线主题接收命令，以及向事件中心发送遥测事件。如果所有设备每天连接 12 小时，则你需要支付以下连接费用（未包括任何其他服务总线费用）：10,000 个连接 * 12 小时 * 31 天/744 = 5,000 个中转连接。在扣除每月 1,000 个中转连接的限额后，你需要按每个中转连接¥0.18的费率支付 4,000 个中转连接的费用，总共 ¥720。

4. 10,000 台设备通过 HTTP 从服务总线队列接收消息，超时不为零。如果所有设备每天连接 12 小时，则你需要支付以下连接费用（未包括任何其他服务总线费用）：10,000 个 HTTP 接收连接 * 12 小时/天 * 31 天/744 小时 = 5,000 个中转连接。

### 中转连接费用是否适用于队列和主题/订阅？

是的。使用 HTTP 发送事件没有连接费用，无论发送系统或设备的数量是多少。使用超时值大于零的 HTTP 接收事件（有时称为“长轮询”）会产生中转连接费用。无论连接是用于发送还是接收，AMQP 连接都会产生中转连接费用。请注意，100 个中转连接在基本命名空间中免费。这也是 Azure 订阅中允许的最大中转连接数。在 Azure 订阅中，所有标准命名空间内的前 1,000 个中转连接都无需支付额外费用（基本费用除外）。由于这些限额足以涵盖许多服务到服务方案，因此通常仅当你打算对大量客户端使用 AMQP 或 HTTP 长轮询时，即，想要实现更高效的事件流或者启用许多设备或应用程序实例的双向通信时，中转连接费用才会变得可观。

## 后续步骤

- 有关服务总线定价的更多详细信息，请参阅 [Azure 服务总线定价页](/pricing/details/service-bus/)。

- 有关服务总线定价和计费的一些常见问题，请参阅[服务总线定价常见问题](/documentation/articles/service-bus-pricing-faq/)。

[Azure 管理门户]: http://manage.windowsazure.cn

<!---HONumber=Mooncake_0215_2016-->