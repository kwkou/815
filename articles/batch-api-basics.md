<properties 
	pageTitle="Azure 批处理( Batch ) API 基础知识" 
	description="向开发人员介绍 Azure 批处理( Batch ) API 和批处理( Batch )服务的概念" 
	services="batch" 
	documentationCenter=".net" 
	authors="yidingzhou" 
	manager="timlt" 
	editor=""/>

<tags 
	ms.service="batch" 
	ms.date="07/14/2015" 
	wacn.date="10/30/2015"/> 
<!--The next line, with one pound sign at the beginning, is the page title-->
# Azure 批处理( Batch ) API 基础知识

Azure 批处理( Batch )服务为可缩放和分布式计算提供作业计划框架。批处理( Batch )服务维护一组位于 Azure 中不同群集和数据中心内的虚拟机。批处理( Batch )服务在指定的一组节点上，根据需求或计划在特定时间运行一个或多个程序，以完成分布式计算。批处理( Batch )服务根据你提供的资源要求、规范和约束管理这些节点，以运行你的计算任务。

通过使用批处理( Batch )服务，你无需编写代码来排队、计划、配置和管理计算资源。这可让你专注于特定的应用程序，而且不需要担心基础平台的作业计划及资源管理的复杂性。这还可以让批处理( Batch )服务优化这些作业的位置，以及它们如何访问需要处理的数据。

以下是批处理( Batch )服务可派上用场的一些案例：

- 计算密集型并行处理

- 每日清理文件

- 批处理( Batch )

## <a name="resource"></a>批处理( Batch )服务的资源

使用批处理( Batch )服务时，可以利用以下资源：

- [帐户](#account)

- [计算节点](#computenode)

- [池](#pool)

- [作业](#job)

- [任务](#task)

	- [启动任务](#starttask)
	
	- [作业管理器任务](#jobmanagertask)

- [JobSchedule](#jobschedule)

### <a name="account"></a>帐户

批处理( Batch )帐户是批处理( Batch )服务中唯一标识的实体。所有处理都是都通过批处理( Batch )帐户完成。当你使用批处理( Batch )服务执行操作时，需要帐户的名称和帐户的密钥。若要创建批处理( Batch )帐户，请参阅[Azure 批处理( Batch )概述][]中的“批处理( Batch )帐户”部分。


### <a name="computenode"></a>计算节点

计算节点（节点）是专门为应用程序处理特定工作负荷的 Azure 节点。节点大小确定了 CPU 核心数目、内存容量，以及分配给节点的本地文件系统大小。节点可以是小型、大型或超大型虚拟机，如 [Azure 的虚拟机和云服务大小](http://msdn.microsoft.com/zh-cn/library/dn197896.aspx)中所述。

节点可以运行的程序类型包括可执行文件 (.exe)、命令文件 (.cmd)、批处理( Batch )文件 (.bat) 和脚本文件。节点还具有以下属性：

- 任务特定的和共享的文件系统文件夹文件夹结构和环境变量在每个池节点上创建。以下文件夹结构是使用在任务之间共享的应用程序和数据的“共享”文件夹以及每个任务的文件夹创建的。

<pre><code> ─ %AZ_BATCH_NODE_ROOT_DIR%
   ├─shared
   ├─startup
   └─&lt;JOB_ID>
     ├─&lt;TASK_ID_1>
     │ └─wd
     └─&lt;TASK_ID_2>
       └─wd
</code></pre>


- 写入任务特定文件夹的 Stdout.txt 和 stderr.txt 文件

- 用于处理的环境变量

- 配置为控制访问的防火墙设置

>节点访问
>
>如果需要访问某个节点（例如，出于调试目的），可以先获取 RDP 文件，然后，使用该文件通过远程桌面访问该节点。


### <a name="pool"></a>池

池是运行应用程序的节点集合。池可以是你自己创建的；当你指定要完成的工作时，批处理( Batch )服务将自动创建池。你可以创建和管理符合应用程序需求的池。池只能由创建它的批处理( Batch )帐户使用。一个批处理( Batch )帐户可以有多个池。

Azure 批处理( Batch )池构建于核心 Azure 计算平台的顶层；批处理( Batch )池提供节点的大规模分配、应用程序和数据的安装、数据移动、运行状况监视和灵活缩放。

添加到池中的每个节点都分配有唯一的名称和一个关联的 IP 地址。从池中删除某个节点时，会丢失对操作系统及其所有本地文件、名称和 IP 地址所做的更改。当某个节点退出池时，它的生存期即告结束。

你可以配置一个池，以便在该池中的节点之间进行通信。如果为池请求了池内通信，批处理( Batch )服务允许在池中每个节点上使用大于 1100 的端口。池中的每个节点都配置为允许与限制只接受这个端口范围和来自池中其他节点的传入连接。如果应用程序不需要节点之间的通信，批处理( Batch )服务可以将不同群集或数据中心上的大量节点分配给池，以实现并行程度更高的处理。

在创建池时，可以指定以下属性：

- 池中的**节点大小**。
	- 需要根据应用程序的要求以及要在节点上使用的应用程序的特征和要求，选择适当的节点大小。通常，选择节点大小时会假设某个任务要在节点上运行一次；例如，应用程序是否是多线程的以及它需要内存量等因素决定了最合适且经济高效的节点大小。可以分配多个任务和并行运行多个应用程序实例，在此情况下，通常会选择较大的节点 - 请参阅下面有关“每个节点的最大任务数”部分。 
	- 池中的所有节点都必须具有相同的大小。如果要根据不同的系统要求和/或不同的负载运行不同的应用程序，则应该创建独立的池。
	- 可为池配置所有云服务节点大小，但 A0 除外。

- 在节点上运行的操作系统系列和版本。
	- 可以像配置辅助角色一样配置操作系统系列和操作系统版本。
	- 操作系统系列还确定了要与操作系统一起安装哪些版本的 .NET。
	- 与辅助角色一样，对于操作系统版本，建议使用“*”，使节点可自动升级，而无需采取措施来适应新的版本。选择特定操作系统版本的主要用例是在允许更新版本之前执行向后兼容测试，以确保保持应用程序兼容性。验证后，便可以更新池的操作系统版本并安装新的操作系统映像 – 所有正在运行的任务将会中断并重新排队。

- 应该为池提供的节点的目标数目。

- 池的缩放策略。除了节点数目以外，你还可以为每个池指定一个自动缩放公式。批处理( Batch )将执行该公式，以根据池和工作项统计信息调整节点的数量。

- 计划配置
	- 默认的配置是在池节点上随时运行一个任务，但在某些情况下，在节点上同时运行多个任务可能更有利。一个示例就是当应用程序必须等待 I/O 时增大节点利用率；执行多个应用程序将会增大 CPU 利用率。另一个示例是减少池中的节点数目；这可能会减少大型引用数据集所需的数据副本数。如果 A1 是应用程序的正确大小，则可以选择 A4，这样，该配置便设置为一次性运行多达 8 个任务，每个任务使用一个核心。
	- “每个节点的最大任务数”配置确定了可以并行运行的最大任务数。
	- 还可以指定“填充策略”，用于确定批处理( Batch )是否要先填充节点，或者是否要在所有节点之间分布任务。
 
- 池中节点的通信状态。
 	- 在大部分方案中，任务是独立运行的，而不需要与其他任务通信，但在某些应用程序中，任务会相互通信（例如，使用 MPI 的应用程序）。
	- 有相应的配置可以控制节点是否能够通信（用于配置底层网络基础结构），和影响节点的位置。

- 池中节点的启动任务。

在创建池时，可以指定应该与池关联的存储帐户。批处理( Batch )服务会将网络连接状态较好的数据中心内的节点分配到指定的存储帐户。这样，工作负载便可以更有效地访问数据。

### <a name="job"></a>作业

作业是任务的集合。作业还指定如何对池中的计算节点执行计算。

- 作业指定要在其上运行工作的池。该池可以是已创建的由多个作业使用的现有池，但是，某个池也有可能是为作业计划关联的每个作业创建的，或者为作业计划关联的所有作业创建的。
- 可以指定一个可选的优先级。如果提交的作业的优先级高于仍在进行中的其他作业，则会将高优先级作业任务插入到队列中低优先级作业任务的前面。已经运行的低优先级任务不会预先清空。
- 约束。
	- 可为作业设置最大挂钟时间。如果作业运行的时间超过了指定的最大挂钟时间，则会结束该作业和所有关联的任务。
	- Azure 批处理( Batch )可以检测失败的任务并重试任务。可以将默认的任务重试最大次数指定为约束，包括指定始终重试或永不重试某个任务。重试某个任务意味着要重新排队并再次运行该任务。
- 客户端可将要针对作业执行的任务添加到作业，但是，还可以指定作业管理器任务。作业管理器任务使用批处理( Batch ) API，并包含相应的代码用于为池节点之一上运行的包含任务的作业创建所需的任务。作业管理器任务专门由批处理( Batch )来处理 – 创建作业以及出于任何原因而重新启动作业后，会立即将任务排队。作业计划创建的作业需要作业管理器，因为它是在实例化作业之前定义任务的唯一方式。


### <a name="task"></a>任务

任务是与作业关联的计算单位，在节点上运行。任务将分配给节点以执行，或进行排队，直到节点变为可用。任务使用以下资源：

- 工作项中指定的程序。

- 包含要处理的数据的资源文件。这些文件自动从 Blob 存储复制到节点。有关详细信息，请参阅“文件和目录”。

- 程序所需的环境设置。有关详细信息，请参阅“任务的环境设置”。

- 运行计算所依据的约束。例如，允许运行任务的最长时间、任务无法运行时应该重试的次数上限，以及文件保留在工作目录中的最长时间。

除了可以定义在节点上运行计算的任务以外，你还可以使用批处理( Batch )服务提供的以下特殊任务：

- [启动任务](#starttask)

- [作业管理器任务](#jobmanagertask)

#### <a name="starttask"></a>启动任务

你可以通过将启动任务与池相关联，设置池中节点的操作系统。安装软件和启动后台进程都是启动任务可以执行的操作。启动任务在节点每次启动时运行，且只要保留在池中就会持续运行。

与任何批处理( Batch )任务一样，除了指定批处理( Batch )执行的命令行以外，还可以指定 Azure 存储中的文件列表。Azure 批处理( Batch )将先从 Azure 存储复制文件，然后再运行命令行。对于池启动任务，文件列表通常包含应用程序文件或包，但它还可能包含池节点上运行的所有任务使用的引用数据。命令行可能会执行任何 PowerShell 脚本或 robocopy，例如，将应用程序文件复制到“共享”文件夹中；它还可以运行 MSI。

通常，批处理( Batch )需要等待启动任务完成，然后认为节点已准备好分配任务，但这种行为是可配置的。

如果某个池节点的启动任务失败，则节点的状态将会更新以反映失败状态，同时，该节点不可用于要分配的任务。如果复制指定给启动任务的文件时出现问题，或者启动任务进程返回了非零值，则启动任务可能会失败。

声明配置节点和安装的应用程序所必需的所有信息的事实意味着增加节点的池中的数量非常简单，只指定新的所需编号；批处理( Batch )已配置节点并使其准备好接受任务所需的所有信息。

可通过将 JSON 部分添加到“添加池”操作的请求正文来定义启动任务。以下示例演示了某个启动任务的基本定义：

	{
		“commandLine”:”mypoolsetup.exe”,
		“resourceFiles”:
		[
			{
				“blobSource”:”http://account.blob.core.chinacloudapi.cn/container/myapp1.exe?st=2013-08-09T08%3a49%3a37.0000000Z&se=2013-08-10T08%3a49%3a37.0000000Z&sr=c&sp=d&si=YWJjZGTVMZw%3d%3d&sig= %2bSzBm0wi8xECuGkKw97wnkSZ%2f62sxU%2b6Hq6a7qojIVE%3d”,
				“filePath”:”mypoolsetup.exe”
			},
			{
				“blobSource”:”http://account.blob.core.chinacloudapi.cn/container/myapp2.exe?st=2013-08-09T08%3a49%3a37.0000000Z&se=2013-08-10T08%3a49%3a37.0000000Z&sr=c&sp=d&si=YWJjZGTVMZw%3d%3d&sig= %2bSzBm0wi8xECuGkKw97wnkSZ%2f62sxU%2b6Hq6a7qojIVE%3d”,
				“filePath”:”myapp2.exe”
			}
		],
		“maxTaskRetryCount”:0
	}

C# 接口如下所示：

	CloudPool pool = pm.CreatePool(poolId, targetDedicated: 3, virtualMachineSize: "small", osFamily: "3");
	pool.StartTask = new StartTask();
	pool.StartTask.CommandLine = "mypoolsetup.exe";
	pool.StartTask.ResourceFiles = new List<IResourceFile>();
	pool.StartTask.ResourceFiles.Add(new ResourceFile("http://account.blob.core.chinacloudapi.cn/container/myapp1.exe?st=2013-08-09T08%3a49%3a37.0000000Z&se=2013-08-10T08%3a49%3a37.0000000Z&sr=c&sp=d&si=YWJjZGTVMZw%3d%3d&sig= %2bSzBm0wi8xECuGkKw97wnkSZ%2f62sxU%2b6Hq6a7qojIVE%3d", "mypoolsetup.exe"));
	pool.Commit();


#### <a name="jobmanagertask"></a>作业管理器任务

作业管理员任务在所有其他任务之前启动。作业管理员任务提供以下优点：

- 创建作业时由批处理( Batch )服务自动创建。

- 安排在作业中的其他任务之前。

- 缩小池时，关联的节点最后才从池中删除。

- 需要重新启动时，它有最高的优先级。如果找不到空闲的节点，批处理( Batch )服务可以终止池中正在运行的某个任务，以便腾出空间供它运行。

- 此终止可能完全取决于作业中的所有任务终止。

作业中的作业管理员任务的优先级不高于其他作业中的任务。不同作业之间只遵循作业级别的优先级。可通过将 XML 部分添加到“添加工作项”操作的请求正文来定义作业管理器任务。以下示例演示了某个作业管理器任务的基本定义：

	{
		“name”:”jmTask”,
		“commandLine”:”myapp1.exe”,
		“resourceFiles”:
		[
			{
				“blobSource”:”http://account.blob.core.chinacloudapi.cn/container/myapp1.exe?st=2013-08-09T08%3a49%3a37.0000000Z&se=2013-08-10T08%3a49%3a37.0000000Z&sr=c&sp=d&si=YWJjZGTVMZw%3d%3d&sig= %2bSzBm0wi8xECuGkKw97wnkSZ%2f62sxU%2b6Hq6a7qojIVE%3d”,
				“filePath”:”myapp1.exe”
			},
			{
				“blobSource”:”http://account.blob.core.chinacloudapi.cn/container/myapp2.exe?st=2013-08-09T08%3a49%3a37.0000000Z&se=2013-08-10T08%3a49%3a37.0000000Z&sr=c&sp=d&si=YWJjZGTVMZw%3d%3d&sig= %2bSzBm0wi8xECuGkKw97wnkSZ%2f62sxU%2b6Hq6a7qojIVE%3d”,
				“filePath”:”myapp2.exe”
			}
		],
		“taskConstraints”:
		{
			“maxWallClockTime”:”PT1H”,
			“maxTaskRetryCount”:0,
			“retentionTime”:”PT1H”
		},
		“killJobOnCompletion”:true,
		“runElevated”:false,
		“runExclusive”:true
	}


### <a name="jobschedule"></a>作业计划

使用作业计划可以根据计划创建多个作业。创建作业计划后，将为每个计划创建一个作业。

## <a name="workflow"></a>批处理( Batch )服务的工作流

你需要批处理( Batch )账户才能使用批处理( Batch )服务，可以使用服务的多个资源来计划计算。当你使用批处理( Batch )服务创建分布式计算方案时，可以使用以下基本工作流：

1. 将你要在分布式计算方案中使用的文件上载到 Azure 存储帐户。这些文件必须在存储帐户中，批处理( Batch )服务才能够访问它们。运行任务时，批处理( Batch )服务将文件加载到节点。

2. 将相关二进制文件上载到存储帐户。二进制文件包括由任务运行的程序和相关程序集。这些文件也必须从存储访问，并已加载到节点。

3. 创建节点池。你可以分配要在创建该池时使用的任务虚拟机的大小。任务运行时，系统从这个池分配节点给它。

4. 创建工作项。在创建工作项时，将自动创建作业。你可以使用工作项管理任务作业。

5. 将任务添加到工作项中。每个任务都使用所上载的程序处理已上载的文件中的信息。

6. 监视输出结果。

## <a name="files"></a>文件和目录

每个任务都有一个工作目录，任务将在该目录中创建零个或多个目录和文件用于存储任务运行的程序、任务处理的数据，以及任务执行的处理的输出。在作业运行期间，这些目录和文件可供其他任务使用。节点上的所有任务、文件和目录由单个用户帐户拥有。

批处理( Batch )服务在节点上公开文件系统的一部分作为根目录。节点的根目录通过 AZ_BATCH_NODE_ROOT_DIR 环境变量提供给任务使用。有关使用环境变量的详细信息，请参阅“任务的环境设置”。

根目录包含以下子目录：

- **任务** - 此位置是属于节点上运行的任务的所有文件的存储位置。对于每个任务，批处理( Batch )服务创建具有唯一路径的任务目录，格式为 %AZ_BATCH_TASK_ROOT_DIR%。此目录提供对任务的读/写访问权限。任务可以创建、读取、更新和删除此目录下的文件，此目录根据任务指定的 RetentionTime 约束而保留。

- **共享** - 此位置是帐户下所有任务的共享目录。在节点上，共享目录位于 %AZ_BATCH_NODE_SHARED_DIR%。此目录提供对任务的读/写访问权限。任务可以创建、读取、更新和删除此目录下的文件。

- **启动** - 启动任务使用此位置做为它的工作目录。由批处理( Batch )服务下载用来运行启动任务的所有文件也存储在此目录下。在节点上，启动目录位于 %AZ_BATCH_NODE_START_DIR%。任务可以创建、读取、更新和删除此目录下的文件，启动任务可以使用此目录来配置操作系统。

从池中删除节点时，也会删除节点上存储的所有文件。

## <a name="lifetime"></a>池和节点生存期

一项基本设计决策是何时创建池，以及节点保持可用的持续时间。

在极端情况下，可以在提交作业以及在任务完成执行后删除节点时，为每个作业创建一个池。这可以最大程度地提高利用率，因为仅当绝对必要时才会分配节点，并且在节点空闲时会立即将其关闭。它意味着，作业必须等待分配节点，不过，你必须注意，在任务单独可用、已分配并且启动任务已完成时，会立即将任务安排给节点；也就是说，批处理( Batch )不会等到池中的所有节点都可用，因为这会导致利用率不佳。

如果优先考虑事务是让作业立即开始执行，则应该创建一个池，并在提交作业之前提供节点。任务可以立即开始，但节点可能会根据负载处于等待作业任务的空闲状态。

进行中负载量变化的一种常见模式是创建一个要将多个作业提交到的池，但同时根据负载增加或减少节点的数目；可以被动或主动（如果负载可预测）执行这种配置。

## <a name="scaling"></a>缩放应用程序

应用程序可以轻松地自动放大或缩小，以配合所需的计算。你可以根据当前的工作负荷和资源使用统计信息动态调整池中的节点数目。还可以通过将应用程序配置为自动缩放，来优化运行应用程序的总体成本。你可以在创建池时指定缩放设置，也可以随时更新配置。

如果节点数目减少，则表明节点上可能正在运行任务，这需要你的注意。指定一个取消分配策略用于确定正在运行的任务是否已停止，以立即删除节点，立即在删除节点之前是否允许任务完成。在作业结束时将节点的目标数目设置为零但允许运行中的任务完成可以最大程度地提高利用率。

可以使用一组缩放公式来指定自动缩放应用程序。这些公式可以用来确定在下一个缩放间隔池中的节点数目。例如，你需要提交大量要在池上计划的任务。你可以分配缩放公式给池，以根据当前的挂起任务数和任务的完成率来指定池大小。批处理( Batch )服务将定期评估公式，并根据工作负载来调整池的大小。

公式可以基于以下度量值：

- **时间度量值** - 根据指定的时数内每隔五分钟收集的统计信息。

- **资源度量值** - 根据 CPU 使用率、带宽使用率、内存使用率和节点的数目。

- **任务度量值** - 根据任务的状态，例如“活动”、“挂起”和“已完成”。

有关自动缩放应用程序的详细信息，请参阅“配置任务虚拟机的自动缩放”。

>删除节点
>
>不经常需要执行此操作，但可以指定要从池中删除的单个节点。例如，如果怀疑某个节点不太可靠，则可以将它删除。

## <a name="cert"></a>应用程序的证书

当你加密机密信息时，通常需要使用证书。证书可以安装在节点上。加密的机密通过命令行参数或内嵌在某个资源中来传递给任务，已安装的证书可用于解密机密。存储帐户的密钥就属于机密信息。

你可以使用“添加证书”操作将证书添加到批处理( Batch )帐户。然后，可以将该证书与新的或现有的池相关联。将证书与池关联后，批处理( Batch )服务将在池中的每个节点上安装该证书。在启动节点之后、启动任何任务（包括启动任务和作业管理员任务）之前，批处理( Batch )服务将安装相应的证书。

## <a name="scheduling"></a>计划优先级

创建某个工作项时，可以向它分配优先级。工作项下的每个任务都以此优先级创建。批处理( Batch )服务使用作业的优先级值来确定帐户中的作业计划顺序。优先级值的范围可为 -1000 到 1000，-1000 表示最低优先级，1000 表示最高优先级。你可以使用 UpdateJob 操作来更新作业的优先级。

在同一个帐户内，高优先级作业的计划优先顺序高于低优先级作业。一个帐户中具有较高优先级值的作业，其计划优先级并不高于不同帐户中较低优先级值的另一个作业。

对不同池的作业计划是独立的。在不同的池之间，即使作业的优先级较高，如果其关联的池缺少空闲的节点，则不保证此作业优先计划。在同一个池中，相同优先级的作业有相同的计划机会。

## <a name="environment"></a>任务的环境设置

可以指定可在任务上下文中使用的环境设置。对于启动任务和作业下运行的任务，环境设置的定义方式是将 XML 部分添加到“添加任务”或“更新任务”操作的请求正文中。

以下示例显示了环境设置的定义：

对于作业下计划的每个任务，批处理( Batch )服务将设置一组特定的环境变量。下表列出了批处理( Batch )服务为所有任务设置的环境变量。

| 环境变量名称 | 说明 |
|------------------------------------|--------------------------------------------------------------------------|
| AZ_BATCH_ACCOUNT_NAME | 任务所属的帐户名。 |
| AZ_BATCH_JOB_ID | 任务所属的作业的名称。 |
| AZ_BATCH_TASK_ID | 当前任务的名称。 |
| AZ_BATCH_POOL_ID | 运行任务的池的名称。 |
| AZ_BATCH_NODE_ID | 运行任务的节点的名称。 |
| AZ_BATCH_NODE_ROOT_DIR | 节点上的根目录的完整路径。 |
| AZ_BATCH_NODE_SHARED_DIR | 节点上的共享目录的完整路径。 |
| AZ_BATCH_NODE_STARTUP_DIR | 节点上的池节点启动任务目录的完整路径。 |
| AZ_BATCH_NODE_TASK_DIR | 节点上的任务目录的完整路径。 |
| AZ_BATCH_NODE_TASK_WORKING_DIR | 节点上的任务工作目录的完整路径。 |
| AZ_BATCH_NODE_JOB_PREP_DIR | 节点上的作业准备任务目录的完整路径。 |
| AZ_BATCH_NODE_JOB_PREP_WORKING_DIR | 节点上的作业准备任务工作目录的完整路径。 |

**Note**

你不能覆盖这些系统定义的变量。

可以使用“获取任务”操作检索环境设置的值。

## <a name="errorhandling"></a>错误处理

###任务失败处理
任务失败划分为以下类别：

- 计划失败：
	- 如果为任务指定了文件，则一个或多个文件的副本可能会失败。这可能是由于文件已移动、存储帐户不再可用等原因造成的。
	- 在此情况下，将为任务设置“计划错误”。
- 应用程序失败：
	- 通过命令行指定的任务进程也可能会失败。如果返回了非零退出代码，则将该进程视为失败。
	- 对于应用程序失败，可以将批处理( Batch )配置为自动重试任务，并最多重试指定的次数。 
- 约束失败：
	- 可以为某个作业或任务可运行的最长时间指定约束。这可以用于终止挂起的任务。
	- 如果超出了最长时间，则将任务标记为已完成，但退出代码将标记为 `0xC000013A`，schedulingError 字段将标记为 `{ category:“ServerError”, code=“TaskEnded”}`。

###调试应用程序失败

应用程序可以生成诊断信息，而这些信息可用于排查问题。通常，应用程序会将信息写入 stdout 和 stderr 文件，或者输出到自定义文件。在这种情况下，可以通过指定任务或节点，使用一个 API 来获取文件。

还可以登录到池节点。API 将返回节点的 RDP 文件，然后，可以使用该文件来登录节点。

###应对任务失败和问题

任务可能会出于某些原因而失败或中断。任务应用程序本身可能会失败，运行任务的节点可能会重新启动，或者在取消分配策略设置为立即删除节点而不等待任务完成的情况下，池大小调整操作会删除节点。在所有情况下，任务都可以由批处理( Batch )自动排队，并在另一个节点上执行。

间歇性的问题也有可能会导致任务挂起，或者花费很长时间才能完成执行。可为任务设置最长执行时间，如果超过此时间，批处理( Batch )会中断任务应用程序。当前，对于这种情况无法自动重新排队，但可以提交新任务的客户端能够检测到这种情况。

###应对“可疑的”节点

池中的每个节点都有一个唯一名称，运行任务的节点包含在任务元数据中。如果某个节点出于某种原因导致任务失败，客户端可以检测到这种情况，并从池中删除可疑的节点。如果运行任务的节点已被删除，该任务将自动重新排队，并在另一个节点上执行。


<!--Image references-->
[1]: ./media/batch-api-basics/batch-api-basics-01.png

[Azure 批处理( Batch )概述]: /documentation/articles/batch-technical-overview

<!---HONumber=66-->