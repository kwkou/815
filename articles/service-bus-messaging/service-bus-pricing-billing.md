<properties 
    pageTitle="服务总线定价和计费 | Azure"
    description="服务总线定价结构概述。"
    services="service-bus"
    documentationCenter="na"
    authors="sethmanheim"
    manager="timlt"
    editor="" />  

<tags 
    ms.service="service-bus"
    ms.devlang="na"
    ms.topic="article"
    ms.tgt_pltfrm="na"
    ms.workload="na"
    ms.date="02/16/2017"
    ms.author="sethm"
    wacn.date="03/20/2017"/>  


# 服务总线定价和计费

服务总线推出基本和标准两种层级。可以为你创建的每个服务总线服务命名空间选择一个服务层，此服务层选择将应用于该命名空间中创建的所有实体。

>[AZURE.NOTE] 有关当前服务总线定价的详细信息，请参阅 [Azure 服务总线定价页](/pricing/details/messaging/)和[服务总线常见问题解答](/documentation/articles/service-bus-faq/#pricing)。

服务总线将以下两种测定仪用于队列和主题/订阅：

1. **消息传送操作**：定义为针对队列或主题/订阅服务终结点进行的 API 调用。此测定仪将替换发送或接收作为队列和主题/订阅的计费用量的主要单元的消息。

2. **中转连接**：定义为在给定的 1 小时采样期间内针对队列、主题或订阅打开的持久连接的最大数目。此测定仪仅适用于标准层。可以在标准层中打开其他连接（以前，每个队列/主题/订阅的连接数限制为 100 个），但只需支付名义上的每连接费用。

**标准**层引入了分级定价用于对队列和主题/订阅执行的操作，从而在达到最高使用率级别时可享受 80% 的基于数量的折扣。


请注意，每个 Azure 订阅每月仅需支付一次标准基本费用。这意味着在创建一个标准服务总线命名空间后，将能够在同一 Azure 订阅下根据需要创建任意数目的标准命名空间，而不会产生附加的基本费用。

在 2014 年 11 月 1 日之前创建的所有现有服务总线命名空间会自动放入标准层。这可确保你继续有权访问服务总线当前可用的所有功能。随后，可以根据需要使用 [Azure 经典管理门户][]降级到基本层。

下表总结了基本和标准之间的功能差异。

|功能|基本|标准|
|---|---|---|
|队列|是|是|
|计划的消息|是|是|
|主题/订阅|否|是|
|中继|否|是|
|事务|否|是|
|重复数据删除|否|是|
|会话|否|是|
|大型消息|否|是|
|ForwardTo|否|是|
|SendVia|否|是|
|附送中转连接|每个服务总线命名空间 100|每个 Azure 订阅 1,000|
|中转连接（允许超额）|否|是（可计费）|

## 消息传送操作

作为新的定价模型的一部分，针对队列和主题/订阅的计费已发生了变化。这些实体从按消息计费转换为按操作计费。“操作”是指针对队列或主题/订阅服务终结点进行的任何 API 调用。这包括管理、发送/接收和会话状态操作。

|操作类型|说明|
|---|---|
|管理|针对队列或主题/订阅的创建、读取、更新、删除 (CRUD) 操作。|
|消息传送|借助队列或主题/订阅发送和接收消息。|
|会话状态|获取或设置队列或主题/订阅的会话状态。|

从2016年4月1日起，消息传送操作的价格会下调 25.5%，以下是下调后的新价格：

|基本|成本|
|---|---|
|操作|每百万个操作 0.31 元|

|标准|成本|
|---|---|
|基本费用|63.29 元/月|
|前 1250 万个操作/月|附送|
|8800 万 - 1 亿个操作/月|每百万个操作 5.21 元|
|1 亿 - 25 亿个操作/月|每百万个操作 3.20 元|
|超过 25 亿个操作/月|每百万个操作 1.27 元|


## 中转连接

*中转连接*允许客户的使用模式涉及针对队列、主题/订阅或事件中心的大量“永久连接”发送方/接收方。永久连接的发送方/接收方是使用具有非零接收超时（例如，HTTP 长轮询）的 AMQP 或 HTTP 连接的那些。具有立即超时的 HTTP 发送方和接收方不会生成中转连接。

以前，队列和主题/订阅限制为每个 URL 100 个并发连接。当前的计费方案中删除了针对队列和主题/订阅的每个 URL 限制，并根据服务总线命名空间和 Azure 订阅级别的中转连接实现配额和计量。

基本层包括并严格限制为每个服务总线命名空间 100 个中转连接。连接数目大于此数字将被拒绝用于基本层中。标准层删除了每个命名空间限制，并计算跨 Azure 订阅的聚合中转连接使用量。在标准层中，每个 Azure 订阅的前 1,000 个中转连接将不收取额外费用（基本费用除外）。在 Azure 订阅的标准层服务总线命名空间中使用总计超过 1,000 个中转连接将按分级计划收费，如下表所示。

|中转连接（标准层级）|成本|
|---|---|
|前 1000 个/月|包含在基本费用内|
|1,000-100,000 个/月|每连接 0.18 元/月|
|100,000-500,000 个/月|每连接 0.15 元/月|
|超过 500,000 个/月|每连接 0.10 元/月|

>[AZURE.NOTE] 标准消息传送层包括 1,000 个中转连接（通过基本费用），可在关联的 Azure 订阅内的所有队列、主题和订阅中共享这些中转连接。

>[AZURE.NOTE]根据并发连接的峰值数量计费，按照每月 744 小时，每小时按比例分配费用。


有关中转连接的详细信息，请参阅本主题后面的[常见问题解答](#FAQ)部分。

## 中继

中继仅适用于标准层命名空间。另外，中继的定价和连接配额保持不变。这意味着中继将继续根据消息数（而不是操作数）和中继小时数计费。

|中继定价|成本|
|---|---|
|中继小时数|每 100 中继小时数收取 0.52 元|
|消息|每 10,000 条消息收取 0.05 元|

## <a name="FAQ"></a> 常见问题

### 如何计算中继小时数？

请参阅[此主题](/documentation/articles/service-bus-pricing-faq/#how-is-the-relay-hours-meter-calculated/)。

### 什么是中转连接，它的计费方式是怎样的？

中转连接定义为下列其中一项：

1. 从客户端到服务总线队列或主题/订阅的 AMQP 连接。

2. 从接收超时值大于零的服务总线主题或队列接收消息的 HTTP 调用。

超出附送数量（标准层为 1,000）的峰值并发中转连接数的服务总线收费。峰值将每小时计量一次，按照每月 744 小时按比例分配费用，并在每月计费周期内累加。在计费周期结束时，将会针对按比例分配的小时峰值的总和应用附送数量（每月 1,000 个中转连接）。

例如：

3. 10,000 台设备的每一台都通过一个 AMQP 进行连接，并接收来自服务总线主题的命令。设备将遥测事件发送至事件中心。如果所有设备每天连接 12 小时，则需支付以下连接费用（未包括任何其他服务总线主题费用）：10,000 个连接 * 12 小时 * 31 天/744 = 5,000 个中转连接。在扣除每月 1,000 个中转连接的限额后，你需要按每个中转连接¥0.18的费率支付 4,000 个中转连接的费用，总共 ¥720。

4. 10,000 台设备通过 HTTP 从服务总线队列接收消息，超时不为零。如果所有设备每天连接 12 小时，则需要支付以下连接费用（未包括任何其他服务总线费用）：10,000 个 HTTP 接收连接 *12 小时/天* 31 天/744 小时 = 5,000 个中转连接。

### 中转连接费用是否适用于队列和主题/订阅？

可以。使用 HTTP 发送事件没有连接费用，无论发送系统或设备的数量是多少。使用超时值大于零的 HTTP 接收事件（有时称为“长轮询”）会产生中转连接费用。无论连接是用于发送还是接收，AMQP 连接都会产生中转连接费用。请注意，100 个中转连接在基本命名空间中免费。这也是 Azure 订阅允许的最大中转连接数。Azure 订阅的所有标准命名空间中的前 1,000 个中转连接包含在内，且无需支付额外费用（基本费用除外）。由于这些限额足以涵盖许多服务到服务方案，因此通常仅当你打算对大量客户端使用 AMQP 或 HTTP 长轮询时，即，想要实现更高效的事件流或者启用许多设备或应用程序实例的双向通信时，中转连接费用才会变得可观。

## 后续步骤

- 有关服务总线定价的更多详细信息，请参阅 [Azure 服务总线定价页](/pricing/details/messaging/)。

- 有关服务总线定价和计费的一些常见问题解答，请参阅[服务总线常见问题解答](/documentation/articles/service-bus-faq/#service-bus-pricing)。

[Azure 经典管理门户]: http://manage.windowsazure.cn

<!---HONumber=Mooncake_Quality_Review_0104_2017-->