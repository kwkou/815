<properties writer="kathydav" editor="tysonn" manager="jeffreyg" />
<tags ms.service=""
    ms.date="12/31/2014"
    wacn.date="04/11/2015"
    />

#如何设置虚拟机的终结点

**注意**：如果要通过主机名直接连接到虚拟机或者设置跨界连接，请参见 [Azure 虚拟网络概述](http://go.microsoft.com/fwlink/p/?LinkID=294063)。

在 Azure 中创建的所有虚拟机都可以通过专用网络通道与同一云服务或虚拟网络中的其他虚拟机自动连接。但是，Internet 上的其他资源或其他虚拟网络需要终结点才能处理虚拟机的入站网络流量。

当您在经典门户中创建虚拟机时，可创建用于远程桌面、Windows PowerShell 远程处理或安全 Shell (SSH) 等的终结点。创建虚拟机后，您可根据需要创建其他终结点。还可通过为终结点的访问控制列表 (ACL) 配置规则来管理公用端口的传入流量。本文向您演示如何执行这两项任务。

每个终结点都有一个公用端口和一个专用端口：

- 专用端口由虚拟机在内部用于侦听终结点上的流量。

- 公用端口由 Azure 负载平衡器用来与来自外部资源的虚拟机进行通信。创建终结点后，您可使用网络访问控制列表 (ACL) 定义帮助隔离和控制公用端口上的传入流量的规则。有关更多信息，请参见[关于网络访问控制列表](http://go.microsoft.com/fwlink/p/?LinkId=303816)。

通过经典门户创建终结点时，将提供这些终结点的端口和协议的默认值。对于所有其他终结点，将在创建终结点时指定端口和协议。可使用 TCP 或 UDP 协议将资源连接到终结点。TCP 协议包括 HTTP 和 HTTPS 通信。

**重点说明**：将自动为与远程桌面和安全 Shell (SSH) 关联的端口进行防火墙配置（大多数情况下与 Windows PowerShell 远程处理有关）。对于为所有其他终结点指定的端口，将不会为来宾操作系统的防火墙中自动进行任何配置。创建终结点时，您将需要在防火墙中配置相应的端口才能允许您计划通过终结点路由的流量。

###创建终结点###

1. 登录到 [Azure 经典门户](http://manage.windowsazure.cn)（如果您尚未这么做）。

2. 单击“虚拟机”，然后选择您要配置的虚拟机。

3. 单击“终结点”。“终结点”页将列出虚拟机的所有终结点。

	![终结点](./media/howto-setup-endpoints/endpointswindows.png)

4.	单击“添加”。

	这将显示“添加终结点”对话框。选择是否将终结点添加到负载平衡集，然后单击箭头以继续。
	
6. 在“名称”中，键入终结点的名称。

7. 在协议中，指定 TCP 或 UDP。

8. 在“公用端口”和“专用端口”中，键入要使用的端口号。这些端口号可以是不同的。公用端口是来自 Azure 外部的通信的入口点，并供 Azure 负载平衡器使用。您可以使用虚拟机上的专用端口和防火墙规则，从而以适合您的应用程序的方式重定向流量。

9. 如果此终结点是负载平衡集中的第一个终结点，请单击“创建负载平衡集”。然后，在“配置负载平衡集”页上，指定名称、协议和探测详细信息。负载平衡集需要探测，这样才能监视此集的运行状况。有关更多信息，请参见[对虚拟机进行负载平衡](/manage/windows/common-tasks/how-to-load-balance-virtual-machines)。

10.	单击复选标记以创建终结点。

	您现在将看到终结点列出在“终结点”页上。

	![成功创建终结点](./media/howto-setup-endpoints/endpointwindowsnew.png)

###管理终结点上的 ACL###

按照下列步骤在终结点上添加、修改或删除 ACL。

**注意**：如果终结点是负载平衡集的一部分，则您对一个终结点上的 ACL 作出的任何更改都适用于此集中的所有终结点。

1. 登录到 [Azure 经典门户](http://manage.windowsazure.com)（如果您尚未这么做）。

2. 单击“虚拟机”，然后选择您要配置的虚拟机。

3. 单击“终结点”。“终结点”页将列出虚拟机的所有终结点。

    ![ACL 列表](./media/howto-setup-endpoints/EndpointsShowsDefaultEndpointsForVM.PNG)

4. 从列表中选择适当的终结点。

5. 单击“管理 ACL”。

    这将显示“指定 ACL 详细信息”对话框。

    ![指定 ACL 详细信息](./media/howto-setup-endpoints/EndpointACLdetails.PNG)

6. 使用列表中的行为 ACL 添加、删除或编辑规则。远程子网值对应于您可作为规则接受或拒绝的 IP 地址范围。将按以第一条规则开始、以最后一条规则结束的顺序来计算规则。这意味着规则应按限制从少到多的顺序列出。有关示例和更多信息，请参见[关于网络访问控制列表](http://go.microsoft.com/fwlink/p/?LinkId=303816)。





